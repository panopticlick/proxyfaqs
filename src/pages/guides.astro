---
export const prerender = true;

import Base from '../layouts/Base.astro';
import { guides } from '../lib/guides';
import { getCategories, type Category } from '../lib/supabase';
import { formatDate, generateCollectionPageSchema } from '../lib/utils';
import { env } from '../lib/env';

let categories: Category[] = [];
try {
  categories = await getCategories();
} catch (error) {
  console.error('Error fetching categories:', error);
}

const siteUrl = env.SITE;
const pageUrl = `${siteUrl}/guides`;

const jsonLd = generateCollectionPageSchema({
  name: 'Proxy Guides - ProxyFAQs',
  description: 'Practical guides to proxies, web scraping, and data collection. Learn faster, avoid blocks, and pick the right proxy type.',
  url: pageUrl,
  itemCount: guides.length,
  items: guides.map((guide) => ({
    name: guide.title,
    url: `${siteUrl}/guides/${guide.slug}`,
  })),
});
---

<Base
  title="Proxy Guides"
  description="Practical guides to proxies, web scraping, and data collection. Learn faster, avoid blocks, and pick the right proxy type."
  canonicalUrl={pageUrl}
  jsonLd={jsonLd}
>
  <section class="bg-gradient-to-b from-primary-50 to-white py-16 md:py-20">
    <div class="container-custom text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-secondary-900 mb-4">
        Proxy Guides
      </h1>
      <p class="text-lg text-secondary-600 max-w-3xl mx-auto">
        Learn the core playbooks for proxies and scraping. Clear steps, practical checklists, and battle-tested recommendations.
      </p>
    </div>
  </section>

  <section class="py-12 bg-white">
    <div class="container-custom">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl md:text-3xl font-bold text-secondary-900">Featured Guides</h2>
        <span class="text-sm text-secondary-500">{guides.length} guides</span>
      </div>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {guides.map((guide) => (
          <a
            href={`/guides/${guide.slug}`}
            class="card-hover group flex flex-col"
          >
            <div class="flex flex-wrap items-center gap-2 text-xs text-secondary-500 mb-3">
              <span class="badge-secondary">{guide.category}</span>
              <span>{guide.readingTime}</span>
              <span>Updated {formatDate(guide.updatedAt)}</span>
            </div>
            <h2 class="text-lg font-semibold text-secondary-900 group-hover:text-primary-600 transition-colors mb-2">
              {guide.title}
            </h2>
            <p class="text-sm text-secondary-600 mb-4">
              {guide.description}
            </p>
            <div class="mt-auto text-sm text-primary-600 font-medium">
              Read guide â†’
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <section class="py-12 bg-secondary-50">
    <div class="container-custom">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
        <div>
          <h2 class="text-2xl md:text-3xl font-bold text-secondary-900">Browse by Category</h2>
          <p class="text-secondary-600">Explore related questions by topic.</p>
        </div>
        <a href="/category" class="text-primary-600 hover:text-primary-700 font-medium">
          View all categories
        </a>
      </div>

      {categories.length > 0 ? (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {categories.slice(0, 9).map((category) => (
            <a
              href={`/category/${category.slug}`}
              class="card-hover flex items-center justify-between"
            >
              <div>
                <h3 class="font-semibold text-secondary-900">{category.name}</h3>
                <p class="text-sm text-secondary-600">
                  {(category.question_count || 0).toLocaleString()} questions
                </p>
              </div>
              <svg
                class="w-5 h-5 text-secondary-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
            </a>
          ))}
        </div>
      ) : (
        <div class="card text-center">
          <p class="text-secondary-600">Categories are loading. Please check back shortly.</p>
        </div>
      )}
    </div>
  </section>

  <section class="py-12 bg-white">
    <div class="container-custom">
      <div class="card bg-gradient-to-br from-primary-50 to-white">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
          <div>
            <h2 class="text-2xl font-bold text-secondary-900 mb-2">Need tailored advice?</h2>
            <p class="text-secondary-600">
              Ask our AI assistant or browse the full knowledge base for detailed answers.
            </p>
          </div>
          <div class="flex flex-wrap gap-3">
            <a href="/search" class="btn-primary">
              Search Questions
            </a>
            <a href="/providers" class="btn-secondary">
              Compare Providers
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</Base>
